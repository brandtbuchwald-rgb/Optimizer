<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rediscover ATKSPD Build Optimizer</title>
<style>
  body{margin:0;background:#1b130d;color:#e8d9bb;
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif}
  h1{font-size:18px;margin:16px 12px}
  .wrap{max-width:1100px;margin:0 auto;padding:8px}
  .panel{background:#2a2119;border:1px solid #504230;border-radius:10px;padding:12px;margin:8px}
  label{display:block;font-size:12px;color:#b7a88c;margin:4px 0}
  select,input{padding:6px;border-radius:6px;border:1px solid #d6c7a6;background:#21170f;color:#e8d9bb}
  .btn{border:1px solid #d6c7a6;background:#23190f;color:#e8d9bb;
       padding:8px 12px;border-radius:8px;cursor:pointer;margin:4px}
  canvas{max-width:100%;margin:10px auto;display:block;border:1px solid #402f22;border-radius:12px}
</style>
</head>
<body>
<h1>Rediscover ATKSPD Build Optimizer</h1>
<div class="wrap">

  <!-- Class selector (kept from original calc) -->
  <div class="panel">
    <label>Class</label>
    <select id="classSel">
      <option value="demonSorcerer">Demon Sorcerer</option>
      <option value="berserker">Berserker</option>
      <option value="priest">Priest</option>
      <!-- add others as needed -->
    </select>
  </div>

  <!-- Weapon selection -->
  <div class="panel">
    <label>Weapon Category</label>
    <select id="weaponCat">
      <option value="normal">Normal</option>
      <option value="glacial">Glacial</option>
      <option value="blaze">Blaze</option>
      <option value="darkness">Darkness</option>
      <option value="venom">Venom</option>
    </select>

    <label>Weapon Type</label>
    <select id="weaponType"></select>
  </div>

  <!-- Targets -->
  <div class="panel">
    <label>Target ATK SPD</label>
    <input id="t_atkspd" type="number" step="0.01" value="0.25">
    <label>Target Evasion % (cap 40%)</label>
    <input id="t_eva" type="number" step="1" value="40">
    <label>Target Crit % (cap 50%)</label>
    <input id="t_crit" type="number" step="1" value="50">
  </div>

  <!-- Buttons -->
  <div class="panel">
    <button class="btn" id="run">Optimize</button>
    <button class="btn" id="render">Render Picture</button>
    <button class="btn" id="save">Download PNG</button>
    <div id="status"></div>
  </div>

  <!-- Results -->
  <div class="panel">
    <strong>Result</strong>
    <div id="result">—</div>
  </div>

  <!-- Card -->
  <div class="panel">
    <canvas id="card" width="1200" height="800"></canvas>
  </div>

</div>

<script>
// ---------- Normal weapon stat pools (empty placeholders) ----------
const NORMAL_POOLS = {
  Primal:{slots:{Helm:{},Chest:{},Gloves:{},Boots:{},Belt:{},Ring:{},Necklace:{},Weapon:{}}},
  Abyss:{slots:{Helm:{},Chest:{},Gloves:{},Boots:{},Belt:{},Ring:{},Necklace:{},Weapon:{}}},
  Chaos:{slots:{Helm:{},Chest:{},Gloves:{},Boots:{},Belt:{},Ring:{},Necklace:{},Weapon:{}}},
  Original:{slots:{Helm:{},Chest:{},Gloves:{},Boots:{},Belt:{},Ring:{},Necklace:{},Weapon:{}}}
};

// ---------- Boss weapons ----------
const BOSS_WEAPONS = {
  glacial:{
    Sword:{name:"Glacial Sword",stats:["ATK% +14–26","Dmg to Monsters +25–40","Crit DMG +25–40"],skill:"Chance to cast Rampage"},
    Bow:{name:"Glacial Bow",stats:["ATK% +14–26","Dmg to Monsters +25–40","Crit DMG +25–40"],skill:"Chance to cast Frozen Soul"},
    Staff:{name:"Glacial Staff",stats:["ATK% +14–26","Dmg to Monsters +25–40","Crit DMG +25–40"],skill:"Chance to cast Frozen Soul"}
  },
  blaze:{
    Hammer:{name:"Blaze Hammer",stats:["ATK% +14–26","Dmg to Monsters +25–40","Crit DMG +25–40"],skill:"Chance to cast Dragon’s Rage"},
    Staff:{name:"Blaze Staff",stats:["ATK% +14–26","Dmg to Monsters +25–40","Crit DMG +25–40"],skill:"Chance to cast Primordial Power"}
  },
  darkness:{
    Sword:{name:"Darkness Sword",stats:["ATK% +11–23","Dmg to Monsters +20–35"],skill:"Chance to cast Dark Fissure"},
    Hammer:{name:"Darkness Hammer",stats:["ATK% +11–23","Dmg to Monsters +20–35"],skill:"Chance to cast Dark Lightning"},
    Bow:{name:"Darkness Bow",stats:["ATK% +11–23","Dmg to Monsters +20–35"],skill:"Chance to cast Feather Shot"},
    Staff:{name:"Darkness Staff",stats:["ATK% +11–23","Dmg to Monsters +20–35"],skill:"Chance to cast Soul Eater"}
  },
  venom:{
    Blade:{name:"Venom Blade",stats:["ATK% +11–23","Dmg to Monsters +20–35"],skill:"Chance to x3 Damage"},
    Scythe:{name:"Venom Scythe",stats:["ATK% +11–23","Dmg to Monsters +20–35"],skill:"Chance to cast Poison Aura"},
    Bow:{name:"Venom Bow",stats:["ATK% +11–23","Dmg to Monsters +20–35"],skill:"Chance to cast Venom Rain"},
    Staff:{name:"Venom Staff",stats:["ATK% +11–23","Dmg to Monsters +20–35"],skill:"Chance to cast Devour"}
  }
};

// ---------- Dropdown handling ----------
const catSel=document.getElementById("weaponCat");
const typeSel=document.getElementById("weaponType");
function updateTypes(){
  const cat=catSel.value;
  typeSel.innerHTML="";
  if(cat==="normal"){
    ["Primal","Abyss","Chaos","Original"].forEach(k=>{
      const o=document.createElement("option");o.value=k;o.textContent=k;typeSel.appendChild(o);
    });
  } else {
    Object.keys(BOSS_WEAPONS[cat]).forEach(k=>{
      const o=document.createElement("option");o.value=k;o.textContent=k;typeSel.appendChild(o);
    });
  }
}
catSel.onchange=updateTypes;updateTypes();

// ---------- Optimize (demo integration) ----------
document.getElementById("run").onclick=()=>{
  const cat=catSel.value, wt=typeSel.value;
  let res="";
  if(cat==="normal"){
    res=`Normal weapon selected (${wt}) → 8-slot optimization (using stat pool placeholders).`;
  } else {
    const w=BOSS_WEAPONS[cat][wt];
    res=`Boss weapon selected: ${w.name}<br>${w.stats.join(", ")}<br>${w.skill}<br>(7-slot optimization)`;
  }
  document.getElementById("result").innerHTML=res;
};

// ---------- Render Card (simplified) ----------
document.getElementById("render").onclick=()=>{
  const cat=catSel.value, wt=typeSel.value;
  const C=document.getElementById("card"), ctx=C.getContext("2d");
  ctx.fillStyle="#1b130d";ctx.fillRect(0,0,C.width,C.height);
  ctx.fillStyle="#e8d9bb";ctx.font="24px sans-serif";
  ctx.fillText("Rediscover Build Card",40,50);
  if(cat==="normal"){
    ctx.fillText("Normal Weapon: "+wt,40,100);
    ctx.fillText("8-slot optimization",40,130);
  } else {
    const w=BOSS_WEAPONS[cat][wt];
    ctx.fillText("Boss Weapon: "+w.name,40,100);
    let y=130;ctx.font="18px sans-serif";ctx.fillStyle="#b7a88c";
    w.stats.forEach(s=>{ctx.fillText(s,60,y);y+=24;});
    ctx.fillText(w.skill,60,y+20);
  }
};

// ---------- Save ----------
document.getElementById("save").onclick=()=>{
  const a=document.createElement("a");
  a.download="build.png";
  a.href=document.getElementById("card").toDataURL("image/png");
  a.click();
};
</script>
</body>
</html>
